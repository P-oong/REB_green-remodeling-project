1. 파이썬 버전 3.9.7 / 3.11.9


1. 

---------------
The candidate building with MGM_BLD_PK 30200-100292615 matches the usage type '문화및집회시설' and has a floor area of 6121.03㎡, which is within the specified range of 3,000㎡ to 5,000㎡. This makes it the best match for the energy report building.



-------
지금 바꿀것
1. 규칙 로직 
- EBD 새로운 면적데이터 추가
- 면적 로직 +-5%
- 건물면 포함되는게 맞는지 확인
- 준공일 데이터 추가

2. gpt 프롬프트 
- 건물명 제대로 알아 듣게
- 면적데이터
- 준공일? 데이터 추가 
- 


-------
보고 내용
1. BD연면적 처리 
 - EBD -> RECAP: 46110-261 / 건축물명: 승선생활4호관 / 연면적: 3000 
 - BD ->  RECAP: 46110-261 / 건축물명: 10동(승선생활4호관) / 연면적: 2999.79 
 - * 기존 방식(3000 이하 제거) 따를 시, BD에 알맞은 표제부 제거됨. 제거하지 않아도 연면적 로직에서 고려되니깐 제거하지 않음. 

2. 1차 2차 규칙 기반 처리
- 1차 로직(이건 무조건 맞다 수준의 건축물)
  -> 연면적과 승인일이 정확히 일치하는 경우 (혹은 연면적이 일치하는 경우-> 살짝 위험)
  -> 여러 경우 찍어보고 얼마나 붙는지 통계 보기.

- 2차 로직 설명
  -> 용도: 일치여부 (제거 고려)
  -> 연면적: -5%~+5% 연면적 속하는지 -> 완전 일치하지 않기 때문 
  -> 기관+건물명: 텍스트 일치
       -> EBD: 기관명(제거 고려), 건물명 / BD: 건물명, 동명
       -> 기존 방식(두 변수 합쳐서 비교) 식별 못하는 경우 존재(BD에서 동이름에 있기 때문에 고유값인데 합쳐버려서 텍스트 일치여부 조사하면 고유값이 되지 않음)
       -> 새로운 방식 고려: EBD 건물명을 BD의 건물명, 동명 두번 체크하기(건물명으로 식별 불가능하고 동명의 유니크 값으로 식별 가능한 경우에 분리 가능함.)
  -> 위 사항 점수화. 2점 이상이고(1점은 잘못된 매칭 많음.) max값이 유일하면 매칭
- 매칭 예시 보여드리기
  -> 승선생활4호관 - 10동(승선생활4호관) -> 이럴 경우 매칭 점수 + 1 후보군 중에 가장 높음
  -> 순서 매칭이 아니라, 점수 부여하는 이유: 순서를 정하기 모호함. 모든 변수가 온전하지 않음
- 몇건 붙었는지 통계
- 추가 정보: 층수 있으면 로직 추가 가능 
- 매칭 불가 예시: 사람이 판단 or 기관 문의 필요한 경우는 어떤 경우인지

3. 3차 GPT 매칭 + reason + 정보 부족 판단시 매칭 x 
- 매칭 예시 
- 매칭 현황
- 사람 검수 필요한 부분 예시 

4. 사람 검수
- 1~3차 매칭 실패 건 직접 확인
- 매칭된 것들 더블 체크
- 비고: 매칭 불가, 불가 사유 등등 체크

5. 문서화
- 로직 및 매칭 단계 설명
- 각각 단계 매칭 현황
- 전체 총괄 매칭 현황, 매칭 불가 특징 표시
- 결과 

** 오류
1. BD와 EBD 같은 건물이지만 연면적 다름.
 - 연면적을 우선순위로 두면 위험한 경우 존재 
 - 승인일, 건물명 정확한데 연면적 다름. -> 가장 가까운 연면적 찾는 것은 위험. +-5%는 괜찮지 않을까 ?
 - +-5%도 위험한게 정확히 같지만 아예 다른 연면적 존재..
 - 연면적 다르고, 승인일+건물명일치 -> 연면적 달라고 승인일과 건물명에서 매칭
 - 연면적 정확히 일치(혹은 +-5%) and 승인일+건물명 다름 -> +-5는 위험함, 정확히 일치는 괜찮나..
 - > 0차 연면적 정확히 일치하는 경우 or 연면적 + 승인일 정확히 일치하는 경우 바로 매칭. 그 다음에 1차 2차 3차 매칭으로 넘어갈까? (우선 연면적 정확히 일치하는 경우와 연면적+승인일 일치하는 경우 매칭해보자. 연면적 승인일 층수 3개 매칭하는 경우도 ㄱㄱ )


2. BD와 EBD 같은 건물 이지만 층수 다름.
3. EBD에 있으나 BD에 없는 경우 (EBD건축물 표제부 매칭 불가) *질문* 원본 BD 데이터가 있는건가? 아예 건물 기록이 안된건가??
3.1. EBD 건축물보다 BD 건축물이 더 적음
(ex. EBD건축물에 매칭할 BD 표제부가 아예 없기 때문에 매칭 불가)
3.2 EBD 건축물보다 BD 건축물이 더 많지만, 그래도 EBD건물이 BD에 없음.
(ex. 해양대학교 실제로는 50동 이상 있지만 BD에는 30동 밖에 없음. 이로 인해 해양대 EBD 데이터 중 BD에 없는 데이터 존재함.(해양대 새누리관 등) 이러한 사례 다수 파악)
4. 실제 주소와 다름 (ex. 감사원. 바로 옆 주소 북촌로 109였음)
4.1. 주소 다른데 총괄표제부(RECAP) 같음 -> 정상 여부 파악 필요 *질문* 주소가 다른데 총괄표제부(RECAP)가 같을 수 있나요? 

----------
내일(0319) 할 일
0. 최종 사용 데이터 2개 전처리 검수
1. 1차 로직 여러개 실험 -> 통계 내기
2. 수정된 2차 로직 코드 수정
3. 수정된 3차 gpt 프롬프트 수정하기
4. 샘플 시도 해보기.
5. 괜찮으면 전체 데이터 적용
6. 엑셀 사람 검수 진행, 비고 적기

